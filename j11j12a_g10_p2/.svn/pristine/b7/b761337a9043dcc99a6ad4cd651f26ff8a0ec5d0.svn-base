#include <stdio.h>
#include <stdlib.h>
/*******************
argv[1] Clave cifrada
argv[2] Ruta del fichero diccionario
argv[3] Numero de reventadores
argv[4] Nombre del fichero que contiene diccionario
argv[5] Nombre del fichero donde se apunta el resultado
*/


/*param clave -Clave a a√±adir al fichero
Esta funcion intoduve la clave cifrada en el fichero correspondiente
*/
void insert_clave(char *clave);

/**
param -char fichero -Contiene la ruta del diccionario

esta funcion devuelve  cuantas palabras tiene un fichero**/
int contar_palabras(char *fichero);

/**
param int divisor -posicion del fichero
param char *fichero -contiene la ruta del diccionario
Devuelve en una variable tipo long la posicion del inicio de la siguiente 
palabra encontrada a partir de la posicion dada**/
long dividir(int divisor, char *fichero);


int main(int argc, char * argv[]){
  int reventadores;     //Almacena el numero de reventadores a crear
  long octeto_ini = 0;  //Almacena el valor del octeto inicial del trozo
  long octeto_end;      //Almacena el valor del octeto final del trozo

  sscanf(argv[3],"%d", &reventadores);

  if(argc == 6){
    insert_clave(argv[1]);
    for(int i = 1; i < reventadores; i++){
      octeto_end = dividir(i * contar_palabras(argv[2])/reventadores, argv[2]);
      printf("reventador words %ld %ld %s clave\n",octeto_ini, octeto_end, argv[1]);
      octeto_ini = octeto_end + 1;
    }
    printf("reventador words %ld %d %s clave\n",octeto_ini, contar_palabras(argv[2]), argv[1]);
  }else{
    printf("Argumentos mal introducidos");
  }
}

void insert_clave(char *clave){
  FILE *fich;
  fich = fopen("clave.txt", "w");
  if(fich){
    fprintf(fich,"%s",clave);
  }else{
    printf("no su pudo abrir el cichero clave.txt");
  }
  fclose(fich);
}

int contar_palabras(char *fichero){
  int count = 0;
  char aux[80] ;
  FILE *fich;
  fich = fopen(fichero, "r");

  if(fich){
    while(fscanf(fich, "%c", aux) != EOF){
      count++;
    }
  }else{
    printf("no su pudo abrir el diccionario");
  }
  return count;
}

long dividir(int divisor, char *fichero){
  FILE *fich;
  fich = fopen(fichero, "r");

  if(fich){
    fseek(fich, divisor, SEEK_SET);
    while(fgetc(fich) != '\n'){

    }

  }else{
    printf("no su pudo abrir el diccionario");
  }
  return ftell(fich);
}
